<%= error_messages_for :topic %>
<% @topic = Topic.new unless @topic %>
<% @categories = Category.find(:all, :order => 'categories.position') %>
<% @forum_id = @topic.forum_id unless @topic.forum_id.blank?; @forum_id ||= params[:forum_id].to_i %>
<% form_for @topic do |f| %>
  <div class="box" id="box-new-new">
    <span class="top">New Topic</span>
    <p class="label"><label for="topic_title">Title</label></p>
    <p><%= f.text_field :title, :style => "width:66%" %>
       &nbsp; <%= f.check_box :private %><label for="topic_private"> Private</label>
       &nbsp; <%= f.check_box :locked %><label for="topic_locked"> Locked</label>
    </p>
    <p class="label"><label for="topic_forum">Forum</label></p>
    <p>
      <select id="topic_forum_id" name="topic[forum_id]">
        <option disabled="disabled" value="">Select a Forum</option>
        <% for category in @categories %>
          <option disabled="disabled" value=""><%= category.name %></option>
          <% for forum in category.forums %>
            <option value="<%= forum.id %>"<%= ' selected="selected"' if forum.id == @forum_id %>>&nbsp;&nbsp;<%= forum.name %></option>
          <% end %>
        <% end %>
      </select>
    </p>
    <p class="label"><label for="topic_body">Body</label></p>
    <p><%= f.text_area :body, :rows => '8', :style => 'width:66%;' %></p>
    <p>
      <%= submit_tag "Post Topic", :disable_with => "Post Topic" %>&nbsp;
      <%= link_to('Upload a New File', new_upload_path, :popup => ['height=520,width=820']) %> &nbsp; 
      <% if current_action != 'new' %>
        <%= link_to_function 'Cancel', "$('action').toggle()" %>
      <% else %>
        <%= link_to 'Cancel', forum_root_path %>
      <% end %>
    </p>
  </div>
<% end %>
