<div class="info-left">
  <span class="title">Chat</span>
  <span class="detail">&laquo; <%= render :partial => 'chatters' %></span>
</div>
<div style="clear:both;"> </div>

<% if logged_in? %>
  <div class="info-left" style="width:100%;">
    <% @message = Message.new unless @message %>
    <% remote_form_for @message, :complete => "$('message_body').clear();$('message_body').focus();" do |f| -%>
      <%= f.text_field :body, :value => '', :style => "width:70%;" %>&nbsp; 
      <%= submit_tag "Send", :disable_with => "Post Message" %>&nbsp; 
      <%= link_to('Upload a New File', new_upload_path, :popup => ['height=530,width=820,status=1']) %>
    <% end %>
  </div>
  <div style="clear:both;"> </div>
<% end %>

<table cellspacing="0" class="messages-index">
  <tbody id="messages-index">
    <%= render :partial => 'messages' %>
  </tbody>
</table>
<div class="info-left">
  <%= link_to 'Show More Messages &raquo;', chat_path(:limit => params[:limit].to_i + 100 || 100) %>
</div>
<div class="clear:both;"> </div>

<%= periodically_call_remote :url => refresh_messages_path, :method => 'get', :frequency => 3 %>
<%= periodically_call_remote :url => refresh_chatters_path, :method => 'get', :frequency => 10 %>
<%= javascript_tag "$('message_body').focus();$('message_body').writeAttribute('autocomplete', 'off');" %>